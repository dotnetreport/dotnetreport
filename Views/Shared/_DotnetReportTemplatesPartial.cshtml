<!-- Dotnet Report HTML Templates -->
<script type="text/html" id="report-filter">
    <div class="form-group" data-bind="attr: {id: 'filter-'+uiId }">
        <!-- ko if: !hasForeignKey-->
        <!-- ko if: fieldType=='DateTime'-->
        <!-- ko if: ['=','>','<','>=','<=', 'not equal'].indexOf($parent.Operator()) != -1 -->
        <input class="form-control" data-bind="datepicker: $parent.fmtValue, datepickerOptions: {value: $parent.Value, dateFormat: dateFormat() === 'Custom' ? customDateFormat().replace(/yyyy/g, 'yy') : $root.dateFormatMappings[dateFormat()]}" required />
        <!-- /ko -->
        <!-- ko if: ['between'].indexOf($parent.Operator()) != -1 -->
        From
        <input required class="form-control from-date" data-bind="datepicker: $parent.fmtValue, datepickerOptions: {value: $parent.Value, dateFormat: dateFormat() === 'Custom' ? customDateFormat().replace(/yyyy/g, 'yy') : $root.dateFormatMappings[dateFormat()]}" />
        to
        <input data-bind="datepicker: $parent.fmtValue2, datepickerOptions: {value: $parent.Value2, dateFormat: dateFormat() === 'Custom' ? customDateFormat().replace(/yyyy/g, 'yy') : $root.dateFormatMappings[dateFormat()]}" class="form-control to-date" required />
        <!-- /ko -->
        <!-- ko if: ['range'].indexOf($parent.Operator()) != -1 -->
        <select data-bind="value: $parent.Value" class="form-select" required>
            <option value=""></option>
            <option>Today</option>
            <option>Today +</option>
            <option>Today -</option>
            <option>Yesterday</option>
            <option>This Week</option>
            <option>Last Week</option>
            <option>This Month</option>
            <option>Last Month</option>
            <option>This Year</option>
            <option>Last Year</option>
            <option>This Week To Date</option>
            <option>This Month To Date</option>
            <option>This Year To Date</option>
            <option>Last 30 Days</option>
            <!--<option>This Month Last Year</option>
            <option>Last Month Last Year</option>
            <option>This Quarter</option>
            <option>Last Quarter</option>
            <option>First Quarter</option>
            <option>Second Quarter</option>
            <option>Third Quarter</option>
            <option>Fourth Quarter</option>
            <option>Next 6 Months</option>
            <option>Last 6 Months</option>
            <option>2 Years ago</option>
            <option>3 Years ago</option>
            <option>4 Years ago</option>
            <option>5 Years ago</option>-->
            <optgroup label="Comparison Options">
                <option>>= Today</option>
                <option><= Today</option>
                <option>>= Today +</option>
                <option><= Today +</option>
                <option>>= Today -</option>
                <option><= Today -</option>
            </optgroup>
        </select>
        <div data-bind="if: $parent.Value().indexOf('Today +') >= 0 || $parent.Value().indexOf('Today -') >= 0" class="form-group pull-left" style="padding-top: 5px;">
            <input type="number" class="form-control input-sm pull-left" style="width: 80px;" data-bind="value: $parent.Value2" required /><span style="padding: 5px 5px;" class="pull-left"> days</span>
        </div>
        <!-- /ko -->
        <!-- /ko -->
        <!-- ko if: ['Int','Money','Float','Double'].indexOf(fieldType) != -1 -->
        <!-- ko if: ['=','>','<','>=','<=', 'not equal'].indexOf($parent.Operator()) != -1 && ['is blank', 'is not blank', 'is null', 'is not null'].indexOf($parent.Operator()) == -1 -->
        <input class="form-control" type="number" data-bind="value: $parent.Value, disable: $parent.Operator() == 'is default'" required />
        <!-- /ko -->
        <!-- /ko -->
        <!-- ko if: fieldType=='Boolean' && ['is blank', 'is not blank', 'is null', 'is not null'].indexOf($parent.Operator()) == -1 -->
        <select required class="form-select" data-bind="value: $parent.Value, disable: $parent.Operator() == 'is default'">
            <option value="1">Yes</option>
            <option value="0">No</option>
        </select>
        <!-- /ko -->
        <!-- ko if: ['Int','Money','Float','Double','Date','DateTime','Boolean'].indexOf(fieldType) == -1 && ['is blank', 'is not blank', 'is null', 'is not null'].indexOf($parent.Operator()) == -1 -->
        <input class="form-control" type="text" data-bind="value: $parent.Value, disable: $parent.Operator() == 'is default'" required />
        <!-- /ko -->
        <!-- /ko -->
        <!-- ko if: hasForeignKey && $parent.Operator() != 'all' -->
        <!-- ko if: hasForeignParentKey && $parent.showParentFilter() -->
        <select multiple class="form-control" data-bind="select2: { dropdownParent: $parent.inModal ? '#filter-'+uiId : '', placeholder: 'Please Choose', allowClear: true }, options: $parent.ParentList, optionsText: 'text', optionsValue: 'id', selectedOptions: $parent.ParentIn"></select>
        <!-- /ko -->
        <!-- ko if: $parent.Operator()=='='-->
        <select required class="form-control" data-bind="select2: { dropdownParent: $parent.inModal ? '#filter-'+uiId : '', placeholder: 'Please Choose', allowClear: true }, options: $parent.LookupList, optionsText: 'text', optionsValue: 'id', value: $parent.Value, optionsCaption: 'Please Choose'"></select>
        <!-- /ko -->
        <!-- ko if: $parent.Operator()=='in' || $parent.Operator()=='not in'-->
        <select required multiple class="form-control" data-bind="select2: { dropdownParent: $parent.inModal ? '#filter-'+uiId : '', placeholder: 'Please Choose', allowClear: true }, options: $parent.LookupList, optionsText: 'text', optionsValue: 'id', selectedOptions: $parent.ValueIn"></select>
        <!-- /ko -->
        <!-- /ko -->
    </div>
</script>
<script type="text/html" id="pager-template">
    <div class="pager-container d-flex flex-row align-items-center flex-wrap">
        <a href="" title="first" data-bind="click: first, enable: !isFirstPage()"><i class="fa fa-backward report-pager-btn" style="font-size: 18px;"></i></a>&nbsp;
        <a href="" title="previous" data-bind="click: previous, enable: !isFirstPage()"><i class="fa fa-caret-left fa-2x report-pager-btn"></i></a>
        <select class="form-select form-control-sm" data-bind="options: [10,30,50,100,150,200,500], value: pageSize" style="width:auto"></select>
        <span class="pager-pageinfo d-flex flex-row align-items-center flex-wrap">
            <span>&nbsp;Page</span>&nbsp;
            <input type="number" min="1" pattern="[0-9]*" class="form-control form-control-sm text-center" style="width:auto" data-bind="
                                value: currentPage,
                                attr: { max: pages() }" />&nbsp;
            <span>of</span>&nbsp;
            <span data-bind="text: pages"></span>
        </span>&nbsp;

        <a href="" title="next" data-bind="click: next, enable: !isLastPage()"><i class="fa fa-caret-right fa-2x report-pager-btn"></i></a>&nbsp;
        <a href="" title="last" data-bind="click: last, enable: !isLastPage()"><i class="fa fa-forward report-pager-btn" style="font-size: 18px;"></i></a>
    </div>
</script>

<script type="text/html" id="report-column-header">
    <!-- ko foreach: Columns -->
        <th data-bind="attr: { id: !IsPivotField ? fieldId : 'pivot--' + fieldName }, style: {'text-align': fieldAlign ? fieldAlign : (IsNumeric ? 'right' : 'left'), 'background-color': headerBackColor }, hidden: outerGroup" style="border-right: 1px solid;">

        <div class="pull-left" data-bind="if: !$parent.IsDrillDown()" style="padding-right: 5px;">
            <div class="dropup">
                <a href="#" data-bs-toggle="dropdown" aria-haspopup="false" aria-expanded="false">
                    <span class="fa fa-ellipsis-v sortable" title="Drag to reorder"></span>
                </a>
                <ul data-bind="visible: !IsPivotField" class="dropdown-menu" style="z-index: 1001;">
                    <li class="dropdown-item small" data-bind="visible: !IsNumeric">
                        <a href="#" data-bind="click: toggleOuterGroup">
                            <span class="fa fa-clone"></span> Outer Group
                        </a>
                    </li>
                    <li class="dropdown-item small">
                        <a href="#" data-bind="click: setupFieldOptions">
                            <span class="fa fa-gear"></span> Field Settings
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <div data-bind="style: {'width': fieldWidth}">
        <!-- ko if: $parents[3].useStoredProc ? $parents[3].useStoredProc() : ($parents[5].useStoredProc ? $parents[5].useStoredProc() : false) -->
        <span data-bind="text: fieldLabel() ? fieldLabel() : fieldName, style: {'color': headerFontColor, 'font-weight': headerFontBold() ? 'bold' : 'normal'}"></span>
        <!-- /ko -->
        <!-- ko ifnot: $parents[3].useStoredProc ? $parents[3].useStoredProc() : ($parents[5].useStoredProc ? $parents[5].useStoredProc() : false)  -->
        <a href="" data-bind="click: function(){ if (!IsPivotField) { $parents[pagerIndex($parents)].changeSort(SqlField); } }, style: {'color': headerFontColor, 'font-weight': headerFontBold() ? 'bold' : 'normal'}">
            <span data-bind="text: $parent.IsDrillDown() && fieldLabel2() ? fieldLabel2() : (fieldLabel() ? fieldLabel() : fieldName)"></span>
            <span data-bind="text: $parents[pagerIndex($parents)].pager.sortColumn() === SqlField ? ($parents[pagerIndex($parents)].pager.sortDescending() ? '&#9660;' : '&#9650;') : ''"></span>
        </a>
        <!-- /ko -->
        </div>
    </th>
    <!-- /ko -->
</script>

<script type="text/html" id="report-widget">
    <div style="text-align: center; width: 100%;font-size: 48px">
        <span  data-bind="visible: Rows.length < 1" title="No data found">/</span>

        <div data-bind="if: Rows.length > 0">
            <div data-bind="with: $parent.rows[0].Items[0]">
                <span data-bind="html: formattedVal"></span>
            
                <!-- ko if: $parent.Rows.length > 1 -->
                <span data-bind="style: {'color': $parent.calculateRate() > 0 ? 'green' : 'red', 'font-size': '24px'}" >
                    <span data-bind="html: $parent.calculateRate() + '%'"></span>
                </span>

                <div data-bind="style: {'font-size': '24px', 'color': 'gray'}, css: {'text-muted': true}">
                    Prior Period: <span data-bind="html: $parent.Rows[1].Items[0].formattedVal"></span>
                </div>
                <!-- /ko -->

            </div>
        </div>
    </div>

</script>

<script type="text/html" id="report-column">
    <!-- ko foreach: Items -->
    <td data-bind="hidden: outerGroup, style: {'background-color': _backColor ?? backColor(), 'color': _fontColor ?? fontColor(), 'font-weight': fontBold() || _fontBold ? 'bold' : 'normal', 'text-align': fieldAlign ? fieldAlign : (Column.IsNumeric ? 'right' : 'left')}">
        <div data-bind="style: {'width': fieldWidth }">
        <!-- ko if: LinkTo-->
        <a data-bind="attr: {href: LinkTo}" target="_blank"><span data-bind="html: formattedVal"></span></a>
        <!-- /ko-->
        <!-- ko ifnot: LinkTo-->
        <span data-bind="html: formattedVal"></span>
        <!-- /ko-->
        </div>
    </td>
</script>

<script type="text/html" id="report-pivot">
        <div class="table-responsive" data-bind="with: ReportData">
        <table class="table table-striped table-hover table-condensed">
            <thead style="position: sticky; top: -1px; z-index: 2;">
                <tr>
                    <th></th>
                    <!-- ko foreach: Rows -->
                    <th>
                        <span data-bind="text: Items[0].FormattedValue"></span>
                    </th>
                    <!-- /ko -->
                </tr>
            </thead>
            <tbody data-bind="foreach: Columns">
                <tr>
                <!-- ko if: $index() > 0 -->
                <td>
                    <span data-bind="text: fieldLabel || ColumnName"></span>
                </td>
                <!-- ko foreach: $parent.Rows -->
                <td data-bind="style: {'background-color': $parent.backColor, 'color': $parent.fontColor, 'font-weight': $parent.fontBold() ? 'bold' : 'normal', 'text-align': $parent.fieldAlign ? $parent.fieldAlign : ($parent.IsNumeric ? 'right' : 'left') }">
                    <span data-bind="text: Items[$parentContext.$index()].FormattedValue"></span>
                </td>
                <!-- /ko -->
                <!-- /ko -->
                </tr>
            </tbody>
        </table>

    </div>

</script>

<script type="text/html" id="report-table">
    <div class="table-responsive" >
        <table class="table table-hover table-condensed" data-bind="attr: {class: 'table table-striped table-hover table-condensed ' + $parents[2].selectedStyle()}">
            <thead style="position: sticky; top: -1px; z-index: 2;" data-bind="if: !$parents[2].noHeaderRow()">
                <tr class="no-highlight" data-bind="sortableColumns: { handle: '.sortable', cursor: 'move', placeholder: 'drop-highlight',selectedFields: $parents[2].SelectedFields }">
                    <!-- ko if: $parentContext.$parentContext.$parent.canDrilldown() && !IsDrillDown() && !CanExpandOption() && !$parents[2].hasPivotColumn() -->
                    <th style="width: 30px; border-left: 1px solid;"></th>
                    <!-- /ko -->
                    <!-- ko template: 'report-column-header', data: $data -->
                    <!-- /ko-->
                </tr>
            </thead>
            <tbody data-bind="attr: {id: 'report-table-body' + $parents[2].ReportID()}">
                <tr style="display: none;" data-bind="visible: Rows.length < 1">
                    <td class="text-info" data-bind="attr:{colspan: Columns.length}">
                        No records found
                    </td>
                </tr>

                <!-- ko if: !$parents[2].hasPivotColumn() && (!$parents[2].ShowExpandOption() || $parents[2].ReportType() == 'List') -->
                <!-- ko foreach: $parent.rows  -->
                <tr>
                    <!-- ko if: $parentContext.$parentContext.$parentContext.$parent.canDrilldown() && !$parent.IsDrillDown() && !$parent.CanExpandOption() && $parentContext.$parentContext.$parentContext.$parent.ReportType() != 'Single' -->
                    <td style="width: 30px; vertical-align: middle;"><a href="#" data-bind="click: function(){ toggle(); }"><span class="fa" data-bind="css: {'fa-plus': !isExpanded(), 'fa-minus': isExpanded()}"></span></a></td>
                    <!-- /ko -->
                    <!-- ko template: 'report-column', data: $data -->
                    <!-- /ko-->
                </tr>
                <!-- ko if: isExpanded -->
                <tr>
                    <td style="width: 30px;"></td>
                    <td data-bind="attr:{colspan: $parent.Columns.length }" style="padding-left: 0px;">
                        <div data-bind="visible: !DrillDownData()">
                            <div class="report-spinner"></div>
                        </div>
                        <!-- ko if: DrillDownData -->
                        <table class="table table-striped table-hover table-condensed" data-bind="with: DrillDownData">
                            <thead>
                                <tr class="no-highlight">
                                    <!-- ko template: 'report-column-header', data: $data -->
                                    <!-- /ko-->
                                </tr>
                            </thead>
                            <tbody>
                                <tr style="display: none;" data-bind="visible: Rows && Rows.length < 1">
                                    <td class="text-info" data-bind="attr:{colspan: Columns.length}">
                                        No records found
                                    </td>
                                </tr>
                                <!-- ko foreach: Rows  -->
                                <tr>
                                    <!-- ko template: 'report-column', data: $data -->
                                    <!-- /ko-->
                                </tr>
                                <!-- /ko -->
                            </tbody>
                        </table>
                        <div class="col-xs-12 col-centered" data-bind="with: pager">
                            <div class="form-inline small text-muted">
                                <div class="pull-left total-records" data-bind="visible: pages()">
                                    <span data-bind="text: 'Total Records: ' + totalRecords()"></span>
                                </div>
                                <div class="pull-left">
                                    <button class="btn btn-xs" title="Download Excel" data-bind="click: $parent.exportExcel"><span class="fa fa-file-excel-o"></span></button>
                                </div>
                                <div class="form-group pull-right" data-bind="visible: pages()">
                                    <div data-bind="template: 'pager-template', data: $data"></div>
                                </div>
                            </div>
                        </div>
                        <!-- /ko -->
                    </td>
                </tr>
                <!-- /ko -->
                <!-- /ko -->
                <!-- /ko-->
            </tbody>
            <!-- ko if: $parentContext.$parent.SubTotals().length == 1 && $parentContext.$parentContext.$parent.OuterGroupColumns().length == 0 -->
            <tfoot data-bind="foreach: $parentContext.$parent.SubTotals">
                <tr class="sub-total">
                    <!-- ko if: $parentContext.$parentContext.$parentContext.$parent.canDrilldown() && !$parent.IsDrillDown() -->
                    <td></td>
                    <!-- /ko -->
                    <!-- ko foreach: Items -->
                    <!-- ko if: Value != 'NA' && Value != 'NaN' && !outerGroup() -->
                    <td data-bind="style: {'background-color': backColor, 'color': fontColor, 'font-weight': fontBold() ? 'bold' : 'normal', 'text-align': $parents[4].pager && $parents[4].ReportType()=='Single' ? 'center' : (fieldAlign ? fieldAlign : (Column.IsNumeric ? 'right' : 'left')), 'font-size':$parents[4].pager && $parents[4].ReportType()=='Single' ? '48px' : ''}">
                        <span data-bind="html: formattedVal, css: {'right-align': true}"></span>
                    </td>
                    <!-- /ko -->
                    <!-- /ko -->
                </tr>
            </tfoot>
            <!-- /ko -->
        </table>
    </div>
</script>

<script type="text/html" id="report-template">
    <div class="report-chart" data-bind="attr: {id: 'chart_div_' + $parent.ReportID()}, visible: $parent.isChart"></div>
    <!-- ko if: $parent.ReportType() == 'Pivot' -->
    <div data-bind="template: {name: 'report-pivot', data: $data }"></div>
    <!-- /ko -->

    <!-- ko if: $parent.ReportType() != 'Pivot' && (!$parent.isChart() || $parent.ShowDataWithGraph()) -->
    <div class="pull-right" data-bind="if: $parent.OuterGroupColumns().length > 0">
        <a href="#" data-bs-toggle="dropdown" aria-haspopup="false" aria-expanded="false">
            Manage Groups <span class="fa fa-ellipsis-v"></span>
        </a>
        <ul class="dropdown-menu" style="z-index: 1001;" data-bind="foreach: $parent.OuterGroupColumns">
            <li class="dropdown-item small">
                <a href="#" data-bind="click: remove" title="Remove from Group">
                    <span class="fa fa-close"></span> <span data-bind="text: fieldName"></span>
                </a>
            </li>
        </ul>
    </div>
    <div class="clear-fix"></div>

    <div data-bind="foreach: outerGroupData">
        <!-- ko if: rows.length > 0 || ($parent.outerGroupData && $parent.outerGroupData().length == 1) -->
        <h6 data-bind="html: display"></h6>
        <div class="" style="padding-top: 5px;"></div>

        <!-- ko if: $parents[1].ReportType() != 'Single'-->
        <div data-bind="template: {name: 'report-table', data: $parent.ReportData }"></div>
        <!-- /ko -->

        <!-- ko if: $parents[1].ReportType() == 'Single'-->
        <div data-bind="template: {name: 'report-widget', data: $parent.ReportData }"></div>
        <!-- /ko -->

        <!-- /ko -->
    </div>
    <!-- /ko -->
</script>
<script type="text/html" id="admin-mode-template">
    <div class="row" style="margin-bottom: 10px;">
        <div class="d-flex justify-content-end align-items-center">
            <div class="bubble-badge">
                Admin Mode
                <div class="form-check form-switch ms-2">
                    <input class="form-check-input" id="admin-mode" type="checkbox" data-bind="checked: adminMode">
                </div>
            </div>
        </div>
    </div>
    <div class="alert alert-info" data-bind="visible: adminMode">
        <i class="fa fa-user-circle"></i> Admin Mode is turned on now, it allows you to setup and view Reports or Dashboards for all roles and users. You should remove the Admin mode toggle for non-admin users.<br />
    </div>
</script>
<script type="text/html" id="manage-access-template">
    <h5><span class="fa fa-key"></span>Manage Access</h5>
    <div class="panel panel-default panel-body" style="margin-left: 20px;">

        <div class="form-group row">
            <label class="col-md-3 col-sm-3 control-label">Client Id to Restrict Access</label>
            <div class="col-md-3 col-sm-3">
                <input class="form-control text-box single-line" type="text" data-bind="value: manageAccess.clientId">
            </div>
            <div class="col-md-1 col-sm-1">
                <span data-bs-toggle="tooltip" data-placement="right" class="fa fa-question-circle helptip" title="Leave blank to give all clients access (Global Reports)"></span>
            </div>
        </div>
        <div class="alert alert-info">
            <span class="fa fa-lightbulb-o fa-2x"></span>&nbsp;User level rights override Role level rights. No selection for a rule implies report is available to all.
        </div>

        <div class="row small">
            <div class="col-md-6">
                <b>Manage by User</b> (allow edit)
                <div class="row container-fluid">
                    <!-- ko foreach: manageAccess.users -->
                    <div class="pull-left">
                        <div class="checkbox">
                            <label class="label label-info">
                                <input type="checkbox" data-bind="checked: selected">&nbsp;<span data-bind="text: text"></span>&nbsp;
                            </label>
                        </div>
                    </div>
                    <!-- /ko -->
                    <div data-bind="if: manageAccess.users.length == 0">
                        Users list not populated or not applicable
                    </div>
                </div>
                <br />
                <b>View only by User</b> (no edit/delete)
                <div class="row container-fluid">
                    <!-- ko foreach: manageAccess.viewOnlyUsers -->
                    <div class="pull-left">
                        <div class="checkbox">
                            <label class="label label-info">
                                <input type="checkbox" data-bind="checked: selected">&nbsp;<span data-bind="text: text"></span>&nbsp;
                            </label>
                        </div>
                    </div>
                    <!-- /ko -->
                    <div data-bind="if: manageAccess.users.length == 0">
                        Users list not populated or not applicable
                    </div>
                </div>
                <br />
                <div data-bind="ifnot: manageAccess.isDashboard">
                    <b>Delete by User</b> (allow delete)
                    <div class="row container-fluid">
                        <!-- ko foreach: manageAccess.deleteOnlyUsers -->
                        <div class="pull-left">
                            <div class="checkbox">
                                <label class="label label-info">
                                    <input type="checkbox" data-bind="checked: selected">&nbsp;<span data-bind="text: text"></span>&nbsp;
                                </label>
                            </div>
                        </div>
                        <!-- /ko -->
                        <div data-bind="if: manageAccess.users.length == 0">
                            Users list not populated or not applicable
                        </div>
                    </div>
                    <br />
                </div>
            </div>
            <div class="col-md-6">
                <b>Manage by User Role</b> (allow edit)
                <div class="row container-fluid">
                    <!-- ko foreach: manageAccess.userRoles -->
                    <div class="pull-left">
                        <div class="checkbox">
                            <label class="label label-info">
                                <input type="checkbox" data-bind="checked: selected">&nbsp;<span data-bind="text: text"></span>&nbsp;
                            </label>
                        </div>
                    </div>
                    <!-- /ko -->
                    <div data-bind="if: manageAccess.userRoles.length == 0">
                        User Roles list not populated or not applicable
                    </div>
                </div>
                <br />
                <b>View only by User Role</b> (no edit/delete)
                <div class="row container-fluid">
                    <!-- ko foreach: manageAccess.viewOnlyUserRoles -->
                    <div class="pull-left">
                        <div class="checkbox">
                            <label class="label label-info">
                                <input type="checkbox" data-bind="checked: selected">&nbsp;<span data-bind="text: text"></span>&nbsp;
                            </label>
                        </div>
                    </div>
                    <!-- /ko -->
                    <div data-bind="if: manageAccess.userRoles.length == 0">
                        User Roles list not populated or not applicable
                    </div>
                </div>
                <div data-bind="ifnot: manageAccess.isDashboard">
                    <br />
                    <b>Delete by User Role</b> (allow delete)
                    <div class="row container-fluid">
                        <!-- ko foreach: manageAccess.deleteOnlyUserRoles -->
                        <div class="pull-left">
                            <div class="checkbox">
                                <label class="label label-info">
                                    <input type="checkbox" data-bind="checked: selected">&nbsp;<span data-bind="text: text"></span>&nbsp;
                                </label>
                            </div>
                        </div>
                        <!-- /ko -->
                        <div data-bind="if: manageAccess.userRoles.length == 0">
                            User Roles list not populated or not applicable
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</script>
<script type="text/html" id="filter-group">
    <div class="query-builder form-inline" data-bind="foreach: FilterGroups">
        <div class="rules-group-container">
            <div class="rules-group-header">
                <div data-bind="visible: !isRoot">
                    <div class="pull-left">
                        <div class="btn-group btn-group-toggle btn-group-sm" data-bs-toggle="buttons" role="group">
                        <label class="btn btn-light active" style="margin-right: 0px;" >
                            <input type="radio" name="andoroption" data-bind="checked: AndOr, checkedValue: 'And'"> And
                        </label>
                        <label class="btn btn-light active">
                            <input type="radio" name="andoroption" data-bind="checked: AndOr, checkedValue: 'Or'"> Or
                        </label>
                        </div>
                    </div>
                    <div class="pull-right">
                        <button class="btn btn-sm btn-secondary" data-bind="click: $parent.RemoveFilterGroup, visible: !isRoot">Remove Group</button>&nbsp;
                    </div>
                </div>
                <div data-bind="visible: isRoot">
                    <div class="pull-left padded-div">
                        <label> &nbsp;Filter Conditions</label>
                    </div>
                </div>
                <div class="clearfix"></div>
            </div>

            <div class="rules-group-body" data-bind="template: {name: 'filter-inner'}"></div>
        </div>
    </div>
</script>
<script type="text/html" id="fly-filter-template">
    <div class="card" data-bind="visible: FlyFilters().length>0">
        <div class="card-header">
            <a data-bs-toggle="collapse" data-bind="attr: {'data-bs-target': '#filter-panel-' + ReportID() }" href="#">
                <i class="fa fa-filter"></i> Choose Filters
            </a>
        </div>
        <div data-bind="attr: {id: 'filter-panel-' + ReportID() }, css: {collpased: !DontExecuteOnRun(), collapse: !DontExecuteOnRun()}" class="card-body">
            <div>
                <!-- ko foreach: FlyFilters -->
                <div class="row">
                    <div class="col-sm-5 col-xs-4">
                        <div data-bind="with: Field" class="checkbox">
                            <div class="checkbox">
                                <label>
                                    <input type="checkbox" title="Apply this filter" data-bind="checked: $parent.Apply, disabled: forced" /> <span data-bind="text: selectedFilterName"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div data-bind="with: Field" class="col-sm-2 col-xs-3">
                        <div class="form-group" data-bind="if: $parent.Apply">
                            <select class="form-select" data-bind="options: fieldFilter, value: $parent.Operator" required></select>
                        </div>
                    </div>
                    <div data-bind="with: Field" class="col-sm-5 col-xs-5">
                        <div data-bind="if: $parent.Apply">
                            <div data-bind="template: 'report-filter', data: $data"></div>
                        </div>
                    </div>
                </div>
                <!-- /ko -->
                <button class="btn btn-primary" data-bind="click: ExecuteReport">Run</button>
            </div>
        </div>
    </div>
</script>

<script type="text/html" id="filter-inner">
    <div class="rules-list" >
        <div class="rule-container" data-bind="visible: Filters().length>0">
        <table class="table table-striped table-hover table-borderless">
            <thead>
                <tr>
                    <th class="row">
                        <div class="col-md-1"></div>
                        <div class="col-md-4">Field</div>
                        <div class="col-md-2"></div>
                        <div class="col-md-4">Filter</div>
                        <div class="col-md-1"></div>
                    </th>
                </tr>
            </thead>
            <tbody data-bind="foreach: Filters">
                <tr class="rule-container">
                    <td class="row">
                        <div class="col-md-1">
                            <select data-bind="value: AndOr, visible: $index()>0" class="form-control">
                                <option>And</option>
                                <option>Or</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <select class="form-select" style="width: 100%;" data-bind="
                                        options: $parents[$parents.length-2].selectedFieldsCanFilter != undefined
                                                    ? $parents[$parents.length-2].selectedFieldsCanFilter
                                                    : $parents[$parents.length-1].selectedFieldsCanFilter,
                                        optionsText: 'selectedFieldName',
                                        optionsCaption: 'Please Choose',
                                        value: Field,
                                        attr: {required: Field()==null?'required':false},
                                        disable: Field() && Field().forced"></select>
                                </div>
                        </div>
                        <div class="col-md-2">
                            <div data-bind="with: Field">
                                <div class="form-group">
                                    <select class="form-select" style="width: 100%;" data-bind="options: fieldFilter, value: $parent.Operator" required></select>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-5">
                            <div data-bind="with: Field">
                                <div data-bind="template: 'report-filter', data: $data"></div>
                            </div>
                            <!-- ko if: Field() && Field().fieldType == 'DateTime' && Operator() == 'range' && $index()==0 -->
                                <!-- ko if: $parents[$parents.length-2].canAddSeries != undefined && $parents[$parents.length-2].canAddSeries() -->
                                <button class="btn btn-sm btn-secondary" data-bind="click: $parents[$parents.length-2].AddSeries.bind($data)">Add Comparison</button>
                                <!--/ko -->
                                <!-- ko if: $parents[$parents.length-2].canAddSeries == undefined && $parentContext.$parent.canAddSeries != undefined && $parentContext.$parent.canAddSeries()-->
                                <button class="btn btn-sm btn-secondary" data-bind="click: $parentContext.$parent.AddSeries.bind($data)">Add Comparison</button>
                                <!--/ko -->
                            <!--/ko -->
                            <span data-bind="visible: Field() && Field().forced" class="badge bg-info">Required Filter</span>
                        </div>
                        <div class="col-md-1">
                            <div style="display: flex; align-items: center;">
                                <div class="form-group" style="flex-grow: 1;">
                                    <button class="btn btn-sm btn-secondary" data-bind="click: $parent.RemoveFilter, hidden: Field() && Field().forced" title="Remove">
                                        <i class="fa fa-trash"></i>
                                    </button>
                                </div>
                                <div class="form-group" style="flex-grow: 1;" data-bind="with: Field, hidden: document.querySelector('#filter-panel.card-body.collapse')" >
                                    <span class="btn btn-sm" tabindex="0" data-bind="click: function(){ filterOnFly(!filterOnFly()); }, css: {'btn-success': filterOnFly()==true, 'btn-secondary': filterOnFly()==false}">
                                        <span class="fa fa-filter" aria-hidden="true" title="Filter on Report"></span>
                                    </span>
                                </div>
                            </div>

                        </div>
                    </td>
                </tr>
                <!-- ko foreach: compareTo -->
                <tr>
                    <td class="row">
                        <div class="col-md-6">&nbsp;</div>
                        <div class="col-md-2">
                        <span style="text-align: right"><button class="btn btn-sm" data-bind="click: $parents[2].RemoveSeries"><span class="fa fa-trash-o"></span></button></span>
                        <span class="muted">Compare to</span>
                        </div>
                        <div class="col-md-4">
                            <select class="form-select" data-bind="options: Range, value: Value" required></select>
                        </div>
                    </td>
                </tr>
                <!-- /ko -->
            </tbody>
        </table>
        </div>

        <div class="rule-container" >
            <div data-bind="template: {name: 'filter-group'}"></div>
            <div>
                <button class="btn btn-sm btn-outline-secondary" data-bind="click: AddFilterGroup">Add Group</button>
                <button class="btn btn-sm btn-outline-secondary" data-bind="click: AddFilter">Add Filter</button>
            </div>
        </div>
    </div>

</script>

<script type="text/html" id="filter-parameters">
    <div class="table-responsive">
        <span data-bind="hidden: showParameters">No filters available to choose</span>
        <table class="table table-striped table-hover table-borderless" data-bind="visible: showParameters">
            <thead>
                <tr>
                    <th style="width: 30%">Filter</th>
                    <th style="width: 20%"></th>
                    <th style="width: 30%">Value</th>
                    <th></th>
                </tr>
            </thead>
            <tbody data-bind="foreach: Parameters">
                <tr data-bind="ifnot: Hidden">
                    <td data-bind="text: DisplayName">
                    </td>
                    <td>
                        <div class="form-group">
                            <select class="form-select" style="width: 100%;" data-bind="options: operators, value: Operator" required></select>
                        </div>
                    </td>
                    <td data-bind="with: Field">
                        <div data-bind="template: 'report-filter', data: $data"></div>
                    </td>
                    <td></td>
                </tr>

            </tbody>
        </table>
    </div>
</script>

<script type="text/html" id="report-schedule">
    <div data-bind="with: scheduleBuilder" id="schedule-builder-div">
        <div class="form-check">
            <input class="form-check-input" type="checkbox" data-bind="checked: hasSchedule" id="scheduleReportCheckbox">
            <label class="form-check-label" for="scheduleReportCheckbox">
                Set Schedule to send by Email
            </label>
        </div>
        <div data-bind="if: hasSchedule">
                <div class="d-flex align-items-center">
                    <div class="me-3 d-flex align-items-center">
                        <span data-bind="text: selectedOption() != 'once' ? 'Every ' : ''"></span>&nbsp;
                        <select class="form-select" required data-bind="options: options, value: selectedOption" style="min-width: 80px;" ></select>
                    </div>
                    <div data-bind="if: selectedOption() == 'once'" class="me-3 d-flex align-items-center">
                        &nbsp;on&nbsp;<input data-bind="datepicker: selectedDate" class="form-control" required />
                    </div>
                    <div class="d-flex align-items-center">
                        <div data-bind="if: showDays" class="d-flex align-items-center">
                            &nbsp;on&nbsp;
                            <select multiple class="form-select ms-2" required data-bind="select2: { placeholder: 'Choose Days', allowClear: true }, options: days, selectedOptions: selectedDays"></select>
                        </div>
                        <div data-bind="if: showDates" class="d-flex align-items-center">
                            &nbsp;on&nbsp;
                                <select multiple class="form-select" required data-bind="select2: { placeholder: 'Choose Dates', allowClear: true }, options: dates, selectedOptions: selectedDates"></select>
                        </div>
                        <div data-bind="if: showMonths" class="d-flex align-items-center">
                            &nbsp;on&nbsp;
                                <select multiple class="form-select" required data-bind="select2: { placeholder: 'Choose Months', allowClear: true }, options: months, selectedOptions: selectedMonths"></select>
                        </div>
                        <div data-bind="if: showAtTime" class="d-flex align-items-center ms-3">
                            &nbsp;at&nbsp;
                             <select class="form-select me-2" style="min-width: 60px;" data-bind="options: hours, value: selectedHour"></select>
                            <select class="form-select me-2" style="min-width: 60px;" data-bind="options: minutes, value: selectedMinute"></select>
                            <select class="form-select" style="min-width: 80px;" data-bind="value: selectedAmPm">
                                <option>AM</option>
                                <option>PM</option>
                            </select>
                        </div>
                    </div>
                </div>

            <div class="alert alert-info">
                Report will be run and emailed <span data-bind="text: selectedOption() != 'once' ? 'every' : ''"></span> <span data-bind="text: selectedOption"></span>
                <span data-bind="if: selectedOption() == 'once'">
                    on <span class="error" data-bind="visible: !selectedDate()">Please pick a Date</span> <span data-bind="text: selectedDate"></span>
                </span>
                <span data-bind="if: showDays">
                    on <span class="error" data-bind="visible: selectedDays().length == 0">Please pick Day(s)</span> <span data-bind="text: selectedDays"></span>
                </span>
                <span data-bind="if: showDates">
                    on <span class="error" data-bind="visible: selectedDates().length == 0">Please pick Date(s)</span>
                    <span data-bind="foreach: selectedDates"><span data-bind="visible: $index()>0">, </span><span data-bind="text: $data == 1 ? '1st': ($data == 2 ? '2nd' : ($data == 3 ? '3rd' : ($data == 31 ? '31st' : $data+'th')))"></span></span>
                </span>
                <span data-bind="if: showMonths">
                    of <span class="error" data-bind="visible: selectedMonths().length == 0">Please pick Month(s)</span> <span data-bind="text: selectedMonths"></span>
                </span>
                <span data-bind="if: showAtTime">
                    at <span data-bind="text: selectedHour"></span>:<span data-bind="text: selectedMinute"></span> <span data-bind="text: selectedAmPm"></span>
                </span>
            </div>
            <div class="mb-3">
                <div class="row g-3">
                    <label class="col-sm-3 col-form-label">Email to</label>
                    <div class="col-sm-6">
                        <input type="text" class="form-control" data-bind="value: emailTo" placeholder="Enter Email Addresses separated by comma to send the Report to" required />
                    </div>
                    <label class="col-sm-1 col-form-label">Format</label>
                    <div class="col-sm-2">
                        <select class="form-select" data-bind="value: format">
                            <option value="EXCEL">Excel</option>
                            @* <option data-bind="visible: $parent.canDrilldown()" value="EXCEL-SUB">Excel (Expanded)</option> *@
                            <option value="CSV">CSV</option>
                            <option value="PDF">PDF</option>
                            <option value="WORD">Word</option>
                            <option value="LINK">Link</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="mb-3">
                <div class="row g-3">
                    <label class="col-sm-3 col-form-label">Pick Time Zone</label>
                    <div class="col-sm-9">
                        <select class="form-select" data-bind="options: timezonOption,
                                                            optionsText: 'displayName',
                                                            optionsValue: 'timeZoneId',
                                                            value: selectedTimezone,
                                                            select2: {dropdownParent: $('#schedule-builder-div'), allowClear: true, placeholder: 'Set a time zone to send report'}">
                        </select>
                    </div>
                </div>
            </div>
            <div class="mb-3">
                <div class="row g-3">
                    <div class="col-sm-3">
                        <div class="form-check" title="Set a date to start sending scheduled report">
                            <input class="form-check-input" type="checkbox" data-bind="checked: hasScheduleStart" id="scheduleStartCheckbox">
                            <label class="form-check-label" for="scheduleStartCheckbox">
                                Schedule Start Date
                            </label>
                        </div>
                    </div>
                    <div class="col-sm-4" data-bind="if: hasScheduleStart">
                        <input type="text" class="form-control" data-bind="datepicker: scheduleStart" title="Scheduled Report will not be sent before this date" required />
                    </div>
                </div>
            </div>
            <div class="mb-3">
                <div class="row g-3">
                    <div class="col-sm-3">
                        <div class="form-check" title="Set a date to stop sending scheduled report">
                            <input class="form-check-input" type="checkbox" data-bind="checked: hasScheduleEnd" id="scheduleEndCheckbox">
                            <label class="form-check-label" for="scheduleEndCheckbox">
                                Schedule End Date
                            </label>
                        </div>
                    </div>
                    <div class="col-sm-4" data-bind="if: hasScheduleEnd">
                        <input type="text" class="form-control" data-bind="datepicker: scheduleEnd" title="Scheduled Report will not be sent after this date" required />
                    </div>
                </div>
            </div>
        </div>
    </div>


</script>

<script type="text/html" id="report-field-options">
    <div class="modal-dialog" style="max-width: 750px;">
        <div class="modal-content" data-bind="with: editFieldOptions">
            <div class="modal-header">
                <h5 class="modal-title"><span data-bind="text: fieldName"></span> - Setup Additional Field Options</h5>
            </div>
            <div class="modal-body needs-validation">
                 <div class="card card-body">
                     <b>Column Format Settings</b>
                    <div class="form-group row">
                        <label class="col-sm-5 col-md-5 control-label">Pick Data Format</label>
                        <div class="col-sm-7 col-md-7">
                            <select class="form-select" data-bind="options: $parents[1].fieldFormatTypes, value: fieldFormat"></select>
                        </div>
                    </div>
                    <div class="form-group row" data-bind="visible: $parents[1].decimalFormatTypes.indexOf($data.fieldFormat())>=0">
                        <label class="col-sm-5 col-md-5 control-label">Pick Decimal Places</label>
                        <div class="col-sm-7 col-md-7">
                            <input type="number" class="form-control" data-bind="value: decimalPlaces" placeholder="" />
                        </div>
                    </div>
                     <div class="form-group row" data-bind="visible: fieldFormat()=='Currency'">
                        <label class="col-sm-5 col-md-5 control-label">Pick Currency Format</label>
                        <div class="col-sm-7 col-md-7">
                            <select class="form-select" required data-bind="options: $parents[1].currencyFormats, optionsText: 'display',optionsValue: 'value', value: currencyFormat"></select>
                        </div>
                    </div>
                    <div class="form-group row" data-bind="visible: fieldFormat()=='Date'">
                        <label class="col-sm-5 col-md-5 control-label">Pick Date Format</label>
                        <div class="col-sm-7 col-md-7">
                            <select class="form-select" data-bind="options: $parents[1].dateFormats, value: dateFormat"></select>
                        </div>
                     </div>
                     <div class="form-group row" data-bind="visible: fieldFormat()=='Date'">
                        <label class="col-sm-5 col-md-5 control-label">Drilldown Date Format</label>
                        <div class="col-sm-7 col-md-7">
                            <select class="form-select" data-bind="options: ['', 'Day', 'Month', 'Year', 'Month/Year'], value: drillDataFormat"></select>
                        </div>
                    </div>

                     <div class="form-group row" data-bind="visible: dateFormat()==='Custom'">
                         <label class="col-sm-5 col-md-5 control-label">Enter Custom Date Format</label>
                        <div class="col-sm-7 col-md-7">
                            <input type="text" class="form-control" data-bind="value: customDateFormat" placeholder="dd/mm/yyyy" />
                        </div>
                     </div>
                    <div class="form-group row">
                        <label class="col-sm-5 col-md-5 control-label">Choose Column Label</label>
                        <div class="col-sm-7 col-md-7">
                            <input type="text" class="form-control" data-bind="value: fieldLabel" />
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-5 col-md-5 control-label">Inner Column Label</label>
                        <div class="col-sm-7 col-md-7">
                            <input type="text" class="form-control" data-bind="value: fieldLabel2" />
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-5 col-md-5 control-label">Choose Text Alignment</label>
                        <div class="col-sm-7 col-md-7">
                            <select class="form-select" data-bind="options: $parents[1].fieldAlignments, value: fieldAlign"></select>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-5 col-md-5 control-label">Choose Width (leave blank for auto)</label>
                        <div class="col-sm-7 col-md-7">
                            <input type="text" class="form-control" data-bind="value: fieldWidth" />
                        </div>
                    </div>
                </div>
                <br />
                <div class="card card-body">
                    <div class="form-row align-items-center">
                        <div class="col-auto">
                            <b>Header Settings</b>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col">
                            <div class="mb-3">
                                <label class="form-label">Pick Text Color</label>
                                <div class="d-flex">
                                    <input type="color" style="width: 50px; height: 38px;" class="form-control me-2" data-bind="value: headerFontColor" />
                                    <input type="text" style="width: 100px" class="form-control me-2" data-bind="value: headerFontColor" />
                                    <button class="btn btn-sm btn-secondary" title="Apply to all columns" data-bind="click: function(){applyAllHeaderFontColor(!applyAllHeaderFontColor()); }">
                                        <span class="fa" data-bind="css: applyAllHeaderFontColor() ? 'fa-check' : 'fa-paste'"></span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="mb-3">
                                <label class="form-label">Pick Background Color</label>
                                <div class="d-flex">
                                    <input type="color" style="width: 50px; height: 38px;" class="form-control me-2" data-bind="value: headerBackColor" />
                                    <input type="text" style="width: 100px" class="form-control me-2" data-bind="value: headerBackColor" />
                                    <button class="btn btn-sm btn-secondary" title="Apply to all columns" data-bind="click: function(){applyAllHeaderBackColor(!applyAllHeaderBackColor()); }">
                                        <span class="fa" data-bind="css: applyAllHeaderBackColor() ? 'fa-check' : 'fa-paste'"></span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col d-flex align-items-center">
                            <div class="form-check me-3">
                                <input class="form-check-input" type="checkbox" data-bind="checked: headerFontBold" id="headerFontBoldCheckbox">
                                <label class="form-check-label" for="headerFontBoldCheckbox">
                                    Bold Text
                                </label>
                            </div>
                            <button class="btn btn-sm btn-secondary" title="Apply to all columns" data-bind="click: function(){applyAllHeaderBold(!applyAllHeaderBold()); }">
                                <span class="fa" data-bind="css: applyAllHeaderBold() ? 'fa-check' : 'fa-paste'"></span>
                            </button>
                        </div>
                    </div>
                </div>
                <br />
                <div class="card card-body">
                    <div class="form-row align-items-center">
                        <div class="col-auto">
                            <b>Text Settings</b>
                        </div>
                    </div>
                        <div class="row mb-3">
                        <div class="col">
                            <div class="mb-3">
                                <label class="form-label">Pick Text Color</label>
                                <div class="d-flex">
                                    <input type="color" style="width: 50px; height: 38px;" class="form-control me-2" data-bind="value: fontColor" />
                                    <input type="text" style="width: 100px;" class="form-control me-2" data-bind="value: fontColor" />
                                    <button class="btn btn-sm btn-secondary" title="Apply to all columns" data-bind="click: function(){applyAllFontColor(!applyAllFontColor()); }">
                                        <span class="fa" data-bind="css: applyAllFontColor() ? 'fa-check' : 'fa-paste'"></span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="mb-3">
                                <label class="form-label">Pick Background Color</label>
                                <div class="d-flex">
                                    <input type="color" style="width: 50px; height: 38px;" class="form-control me-2" data-bind="value: backColor" />
                                    <input type="text" style="width: 100px;" class="form-control me-2" data-bind="value: backColor" />
                                    <button class="btn btn-sm btn-secondary" title="Apply to all columns" data-bind="click: function(){applyAllBackColor(!applyAllBackColor()); }">
                                        <span class="fa" data-bind="css: applyAllBackColor() ? 'fa-check' : 'fa-paste'"></span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col d-flex align-items-center">
                            <div class="form-check me-3">
                                <input class="form-check-input" type="checkbox" data-bind="checked: fontBold" id="fontBoldCheckbox">
                                <label class="form-check-label" for="fontBoldCheckbox">
                                    Bold Text
                                </label>
                            </div>
                            <button class="btn btn-sm btn-secondary" title="Apply to all columns" data-bind="click: function(){applyAllBold(!applyAllBold()); }">
                                <span class="fa" data-bind="css: applyAllBold() ? 'fa-check' : 'fa-paste'"></span>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="padded-div">
                    <button class="btn btn-sm btn-primary" data-bind="click: function() {addConditionalFormatSetting(null)}">Add Conditional Formatting</button>
                </div>
                <div data-bind="foreach: fieldCondtionalFormats" style="padding-left: 40px;">
                    <div class="card card-body">
                        <div class="row m-2">
                            <div class="col d-flex justify-content-start">
                                <b>Conditional Format #<span data-bind="text: $index()+1"></span></b>
                            </div>
                            <div class="col d-flex justify-content-end">
                                <button class="btn btn-sm btn-secondary" data-bind="click: $parent.removeSetting">Remove</button>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col">
                                <div class="mb-3">
                                    <label class="form-label">Pick Text Color</label>
                                    <div class="d-flex">
                                        <input type="color" style="width: 50px; height: 38px;" class="form-control me-2" data-bind="value: fontColor" />
                                        <input type="text" style="width: 100px;" class="form-control me-2" data-bind="value: fontColor" />
                                    </div>
                                </div>
                            </div>
                            <div class="col">
                                <div class="mb-3">
                                    <label class="form-label">Pick Background Color</label>
                                    <div class="d-flex">
                                        <input type="color" style="width: 50px; height: 38px;" class="form-control me-2" data-bind="value: backColor" />
                                        <input type="text" style="width: 100px;" class="form-control me-2" data-bind="value: backColor" />
                                    </div>
                                </div>
                            </div>
                            <div class="col d-flex align-items-center">
                                <div class="form-check me-3">
                                    <input class="form-check-input" type="checkbox" data-bind="checked: fontBold" id="fontBoldCheckbox">
                                    <label class="form-check-label" for="fontBoldCheckbox">
                                        Bold Text
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="row m-2" data-bind="foreach: filter.Filters">
                            <div class="col-md-2">
                                 Value
                            </div>
                            <div class="col-md-4">
                                <div data-bind="with: Field">
                                    <div class="form-group">
                                        <select class="form-select" style="width: 100%;" data-bind="options: fieldFilter, value: $parent.Operator" required></select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div data-bind="with: Field">
                                    <div data-bind="template: 'report-filter', data: $data"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <br />
                <div class="form-group row" data-bind="if: $parents[1].useStoredProc()">
                    <div class="col-sm-12">
                        <div class="checkbox pull-left" style="padding-top: 5px;">
                            <label>
                                <input type="checkbox" data-bind="checked: checkOuterGroup" />
                                Outer Group
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-bind="click: cancelFieldOptions">Cancel</button>
                <button type="button" class="btn btn-primary" data-bind="click: saveFieldOptions">Save Changes</button>
            </div>
        </div>
    </div>
</script>

<script type="text/html" id="report-link-edit">
    <div class="modal-dialog" style="max-width: 750px;">
        <div class="modal-content" data-bind="with: editLinkField">
            <div class="modal-header">
                <h5 class="modal-title">Setup Link Field</h5>
            </div>
            <div class="modal-body needs-validation" data-bind="with: linkFieldItem">
                <div class="form-group row">
                    <label class="col-sm-5 col-md-5 control-label">This field will link to</label>
                    <div class="col-sm-7 col-md-7">
                        <select class="form-select" required data-bind="options: linkTypes, value: selectedLinkType"></select>
                    </div>
                </div>
                <div data-bind="if: LinksToReport">
                    <div class="form-group row">
                        <label class="col-sm-5 col-md-5 control-label">Link to this Report</label>
                        <div class="col-sm-7 col-md-7">
                            <select class="form-select" required data-bind="options: $parentContext.$parent.SavedReports, optionsText: 'reportName', optionsValue: 'reportId', value: LinkedToReportId, optionsCaption: 'Choose the Report to link to'"></select>
                        </div>
                    </div>
                    <div class="checkbox" data-bind="if: LinkedToReportId">
                        <label>
                            <input type="checkbox" data-bind="checked: SendAsFilterParameter" />
                            Send field value as Report Filter Parameter
                        </label>
                    </div>
                    <div class="form-group row" data-bind="if: SendAsFilterParameter">
                        <label class="col-sm-5 col-md-5 control-label">Link to this Report Filter</label>
                        <div class="col-sm-7 col-md-7">
                            <select class="form-select" required data-bind="options: allFields, optionsText: 'fieldName', optionsValue: 'fieldId', value: SelectedFilterId, optionsCaption: 'Choose the Field to Filter by value'"></select>
                        </div>
                    </div>
                </div>
                <div data-bind="ifnot: LinksToReport">
                    <div class="form-group row">
                        <label class="col-sm-5 col-md-5 control-label">Link to this URL</label>
                        <div class="col-sm-7 col-md-7">
                            <input type="text" class="form-control" required placeholder="Enter a url to open" data-bind="value: LinkToUrl" title="Valid URL needs to start with http:// or https://">
                        </div>
                    </div>
                    <div class="checkbox">
                        <label>
                            <input type="checkbox" data-bind="checked: SendAsQueryParameter" />
                            Send field value as Query Parameter
                        </label>
                    </div>
                    <div class="form-group row" data-bind="if: SendAsQueryParameter">
                        <label class="col-sm-5 col-md-5 control-label">Parameter Name to use</label>
                        <div class="col-sm-7 col-md-7">
                            <input type="text" class="form-control" required placeholder="Enter parameter name to send value as" data-bind="value: QueryParameterName">
                        </div>
                    </div>
                    <br />
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-bind="click: removeLinkField">Remove Link</button>
                <button type="button" class="btn btn-primary" data-bind="click: saveLinkField">Save Changes</button>
            </div>
        </div>
    </div>
</script>

<script type="text/html" id="report-designer">
    <div class="modal-dialog modal-dialog-scrollable" style="height: 100vh;">
        <div class="modal-content" style="display: flex; flex-direction: column; height: 100%;">

            <div class="modal-header">
                <h5 class="modal-title" id="myModalLabel">
                    <a title="Need help setting up a report?" target="_blank" href="https://dotnetreport.com/blogs/docs/designing-reports"><span class="fa fa-question-circle"></span></a> Design your Report
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body needs-validation" style="overflow-y: auto; flex-grow: 1;">
                <div class="row">
               <div class="col-md-4 sticky-column">
                <div class="card card-body" id="choose-data-card">
                    <h5><span class="fa fa-database"></span>&nbsp;Choose Data for Report</h5>
                    <div>
                        <div class="pull-left btn-group btn-group-toggle" role="group" data-bind="if: ReportID() <= 0">
                            <label class="btn btn-sm btn-light active" style="margin-right: 0px;" title="You can change the Data source only when creating a new report, changing this will clear all selections">
                                <input type="radio" name="dataoption" id="table" checked data-bind="checked: useStoredProc, checkedValue: false"> Dynamic
                            </label>
                            <label class="btn btn-sm btn-light active">
                                <input type="radio" name="dataoption" id="proc" value="1" data-bind="checked: useStoredProc, checkedValue: true"> Predefined
                            </label>
                        </div>
                        <div class="pull-right">
                            <a href="#" class="btn btn-secondary btn-sm" title="Add Custom Field using Formula" data-bind="hidden: isFunctionField() || useStoredProc(), click: cancelFormulaField, text: isFormulaField()? 'Cancel': 'Custom Field', css: {'btn-primary': !isFormulaField(), 'btn-danger': isFormulaField}"></a>
                            <a href="#" class="btn btn-secondary btn-sm" title="Add Custom Field using Function" data-bind="hidden: true || isFormulaField() || useStoredProc(), click: function(){designFunctionField()}, text: isFunctionField()? 'Cancel': 'Function Field', css: {'btn-primary': !isFunctionField(), 'btn-danger': isFunctionField}"></a>
                        </div>
                    </div>
                    <div class="clearfix"></div>
                    <div class="row">

                        <div class="col-md-12" data-bind="disable: isFormulaField, hidden: useStoredProc">
                            <div data-bind="with: textQuery.searchFields">
                                <select id="search-field" class="form-control" data-bind="select2: {dropdownParent: $('#choose-data-card'), placeholder: 'Search for a Data Field...', ajax: { url: url, dataType: 'json', data: query, processResults: processResults, headers: headers }, minimumInputLength: 2, allowClear: true }, value: selectedOption"></select>
                            </div>
                        </div>

                        <div class="col-md-12">
                            <div data-bind="visible: useStoredProc">
                            <select class="form-control" data-bind="select2Value: {dropdownParent: $('#choose-data-card')}, options: Procs, optionsCaption: 'Choose Section...', optionsText: 'DisplayName', value: SelectedProc, visible: useStoredProc"></select>
                            </div>
                            <div data-bind="hidden: useStoredProc">
                                 <select id="category-tables" class="form-control"  data-bind="foreach: CategorizedTables, select2Value: {dropdownParent: $('#choose-data-card'), allowClear: true, placeholder: 'Choose Data Section...', optionsText: 'tableName'}, value: SelectedTable">
                                     <option value="" data-bind="visible: $index()==0"></option>
                                     <optgroup data-bind="attr: {label: categoryName}, foreach: tables">
                                         <option data-bind="text: tableName, value: $data"></option>
                                     </optgroup>
                                 </select>
                            </div>
                        </div>

                        <div class="col-md-12 padded-div" data-bind="visible: ChooseFields().length>0">
                            <div class="small pull-left">
                                Select data to use in the Report
                            </div>
                            <div class="pull-right btn-toolbar">
                                <a href="#" class="btn btn-secondary btn-sm" data-bind="click: function(){SelectedTable('')}, visible: !isFormulaField()">Clear</a>
                                <a href="#" class="btn btn-secondary btn-sm" data-bind="click: MoveAllFields, visible: !isFormulaField()">Select all</a>
                                <a href="#" class="btn btn-secondary btn-sm" data-bind="click: RemoveSelectedFields, visible: !isFormulaField()">Remove all</a>
                            </div>
                        </div>
                        <div data-bind="with: SelectedTable">
                            <b><span data-bind="text: tableName"></span></b>
                        </div>
                        <div class="row container-fluid" data-bind="foreach: ChooseFields" style="max-height: 200px; overflow: auto;">
                            <div class="col-md-12 col-sm-12 col-xs-12 list-group">
                                <div class="list-group-item">
                                    <div class="checkbox">
                                        <label>
                                            <input type="checkbox" data-bind="checkedInArray: {array: $parent.isFormulaField() ? $parent.formulaFields : $parent.SelectedFields, value: $data}">
                                            <span data-bind="html: fieldName"></span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <br />
                   <div class="card card-body">
                        <div class="form-group row" data-bind="if: SaveReport">
                            <label class="control-label h6">
                                <i class="fa fa-file"></i> Report Name
                            </label>
                            <div>
                                <input type="text" style="width: 100%;" class="form-control" required placeholder="Report Name" data-bind="value: ReportName">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="control-label h6">
                                <i class="fa fa-info-circle"></i> Description
                            </label>
                            <div>
                                <textarea class="form-control" style="width: 100%;" rows="3" placeholder="Additional details (optional)" data-bind="value: ReportDescription"></textarea>
                            </div>
                        </div>

                        <div class="checkbox" data-bind="visible: isChart">
                            <label>
                                <input type="checkbox" data-bind="checked: ShowDataWithGraph" />
                                Show Data along with Graph
                            </label>
                        </div>
                        <div class="checkbox" data-bind="visible: CanSaveReports()">
                            <label>
                                <input type="checkbox" data-bind="checked: SaveReport">
                                Save Report
                            </label>
                        </div>
                        <div class="form-group row" data-bind="visible: SaveReport">
                            <label class="control-label h6">
                                <i class="fa fa-folder-open"></i> Choose Folder
                            </label>
                            <div>
                                <select class="form-select" style="width: 100%;" data-bind="options: Folders, optionsText: 'FolderName', optionsValue: 'Id', value: FolderID"></select>
                            </div>
                        </div>
                    </div>

                <br />
                </div>
                <div class="col-md-8">
                    <div class="card card-body">
                    <h5><span class="fa fa-file"></span>&nbsp;Choose Visualization</h5>
                    <div style="overflow-x: auto; white-space: nowrap;">
                    <div class="btn-group" role="group" aria-label="Visualization Options">
                        <button class="btn btn-outline-secondary" data-bind="click: function(){ setReportType('List'); }, css: { active: ReportType()=='List' }">
                            <span class="fa fa-2x fa-list-alt"></span>
                            <p>List</p>
                        </button>
                        <button class="btn btn-outline-secondary" data-bind="click: function(){ setReportType('Summary'); }, css: { active: ReportType()=='Summary' }">
                            <span class="fa fa-2x fa-table"></span>
                            <p>Summary</p>
                        </button>
                        <button class="btn btn-outline-secondary" data-bind="click: function(){ setReportType('Bar'); }, css: { active: ReportType()=='Bar' }">
                            <span class="fa fa-2x fa-bar-chart"></span>
                            <p>Bar</p>
                        </button>
                        <button class="btn btn-outline-secondary" data-bind="click: function(){ setReportType('Pie'); }, css: { active: ReportType()=='Pie' }">
                            <span class="fa fa-2x fa-pie-chart"></span>
                            <p>Pie</p>
                        </button>
                        <button class="btn btn-outline-secondary" data-bind="click: function(){ setReportType('Line'); }, css: { active: ReportType()=='Line' }">
                            <span class="fa fa-2x fa-line-chart"></span>
                            <p>Line</p>
                        </button>
                        <button class="btn btn-outline-secondary" data-bind="click: function(){ setReportType('Map'); }, css: { active: ReportType().indexOf('Map')==0 }">
                            <span class="fa fa-2x fa-globe"></span>
                            <p>Map</p>
                        </button>
                        <button class="btn btn-outline-secondary" data-bind="click: function(){ setReportType('Single'); }, css: { active: ReportType()=='Single' }">
                            <span class="fa fa-2x fa-window-maximize"></span>
                            <p>Widget</p>
                        </button>
                        <button class="btn btn-outline-secondary" data-bind="click: function(){ setReportType('Treemap'); }, css: { active: ReportType()=='Treemap' }">
                            <span class="fa fa-2x fa-window-restore"></span>
                            <p>Treemap</p>
                        </button>
                        <button class="btn btn-outline-secondary" data-bind="click: function(){ setReportType('Pivot'); }, css: { active: ReportType()=='Pivot' }">
                            <span class="fa fa-2x fa-random"></span>
                            <p>Transpose</p>
                        </button>
                    </div>
                    </div>
                </div>

                <div>

                    <div data-bind="if: isFunctionField" class="custom-field-design">
                        <br />
                        <br />
                        <div class="card">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-12 pull-right">
                                        <a href="#" class="btn btn-primary btn-sm" title="Save Custom Function Field" data-bind="click: saveFunctionField, visible: isFunctionField">Save</a>
                                        <a href="#" class="btn btn-sm" title="Custom Field using Function" data-bind="click: function(){isFunctionField(!isFunctionField())}, text: isFunctionField()? 'Cancel': 'Function', css: {'btn-primary': !isFunctionField(), 'btn-danger': isFunctionField}"></a>
                                    </div>
                                    <div class="col-md-12 padded-div" data-bind="visible: isFunctionField()">
                                        <div class="alert alert-info">
                                            You are now creating a Customized Field using Functions available.
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group row">
                                    <label class="col-sm-2 control-label">Field Label</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control form-control-sm" data-bind="value: formulaFieldLabel" required placeholder="Custom Field Label" />
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-2 control-label">Data Format</label>
                                    <div class="col-sm-10">
                                        <select class="form-select form-control-sm" data-bind="value: formulaDataFormat" required>
                                            <option>String</option>
                                            <option>Integer</option>
                                            <option>Decimal</option>
                                            <option>Currency</option>
                                            <option>Date</option>
                                            <option value="DateTime">Date and Time</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group row" data-bind="visible: formulaDataFormat() == 'Decimal' || formulaDataFormat() == 'Currency'">
                                    <label class="col-sm-2 control-label">Round to Decimal Places</label>
                                    <div class="col-sm-10">
                                        <input type="number" class="form-control" data-bind="value: formulaDecimalPlaces" placeholder="Choose Decimal places (leave blank to not use rounding)" title="Choose Decimal places (leave blank to not use rounding)" />
                                    </div>
                                </div>

                                <div data-bind="visible: !simpleFunction()">
                                    Define your Function:
                                    <textarea id="function-code"></textarea>
                                </div>

                                <div data-bind="visible: simpleFunction()">
                                <div class="form-group row">
                                    <label class="col-sm-2 control-label">Select Function</label>
                                    <div class="col-sm-10" >
                                        <div data-bind="with: textQuery.searchFunctions">
                                            <select id="search-function" class="form-control" data-bind="select2: {placeholder: 'Search for a Function...', ajax: { url: url, dataType: 'json', data: query, processResults: processResults, headers: headers}, templateResult: templateResult, minimumInputLength: 2, allowClear: true }, select2Value: {value: selectedOption}"></select>
                                        </div>
                                    </div>
                                </div>
                                <div data-bind="with: selectedFunction">
                                    <div class="form-group row" >
                                        <label class="col-sm-2 control-label"></label>
                                        <div class="col-sm-10" >
                                            <p data-bind="text: description"></p>
                                            <p>
                                                <b>Pick values to pass for Parameters below</b>
                                            </p>
                                            <!-- ko foreach: parameters -->
                                            <div class="form-group row" >
                                                <label class="col-sm-6 control-label">
                                                    <span data-bind="text: DisplayName"></span><span data-bind="visble: Required"> (Required)</span><br />
                                                    <span data-bind="text: Description"></span>

                                                </label>
                                                <div class="col-sm-6" >
                                                    <select class="form-select" data-bind="required: Required, options: $parentContext.$parent.ChooseFields, optionsText: 'fieldName', value: selectedField, optionsCaption: 'Pick a field...'"></select>
                                                </div>
                                            </div>
                                            <!-- /ko -->
                                        </div>
                                    </div>

                                </div>
                                </div>
                            </div>
                        </div>
                        <div class="clearfix"></div>
                    </div>

                    <div data-bind="if: lastPickedField() && lastPickedField().fieldType == 'Json'">
                        <br />
                        <div class="card">
                            <div class="card-header">
                                <h6>Select Data Fields from <span data-bind="text: lastPickedField().fieldName"></span></h6>
                            </div>
                            <div class="card-body">
                                <div class="row container-fluid" data-bind="foreach: jsonFields">
                                    <div class="col-md-3 col-sm-4 col-xs-6 list-group">
                                        <div class="list-group-item">
                                            <div class="checkbox">
                                                <label>
                                                    <input type="checkbox" data-bind="checkedInArray: {array: $parent.SelectedFields, value: $data}">
                                                    <span data-bind="text: jsonColumnName"></span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div data-bind="if: isFormulaField" class="custom-field-design">
                        <br />
                        <br />
                        <div class="card">
                            <div class="card-header">
                                <b>Build Custom Field</b>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-12" data-bind="visible: isFormulaField()">
                                        <div class="alert alert-info">
                                            You are now creating a Customized Field. Please select the fields you want to use in the calculation, then choose the operations you want to perform, and click "Save" to add your Custom field.
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 small">
                                        Setup your Formula for calculating this Field
                                    </div>
                                    <div class="col-sm-6 right-align" data-bind="visible: formulaType()=='build'">
                                        <a href="#" class="btn btn-secondary btn-sm" data-bind="click: addFormulaParentheses">Add ( )</a>
                                        <a href="#" class="btn btn-secondary btn-sm" title="Add Today" data-bind="visible: formulaOnlyHasDateFields() || formulaFields().length == 0, click: addFormulaDateToday">Add Today</a>
                                        <a href="#" class="btn btn-secondary btn-sm" title="Add a Constant Value" data-bind="click: addFormulaConstantValue">Add Value</a>
                                        <a href="#" class="btn btn-secondary btn-sm" data-bind="click: clearFormulaField">Clear</a>
                                    </div>
                                </div>
                                <div class="form-group-row" data-bind="if: formulaOnlyHasDateFields">
                                    <div class="col-sm-12">
                                        <div class="alert alert-info">
                                            For Dates Field calculation, you can only substract date fields and display the result as days, hours, minutes or seconds.
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-2 control-label">Field Label</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control form-control-sm" data-bind="value: formulaFieldLabel" required placeholder="Custom Field Label" />
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-2 control-label">Data Format</label>
                                    <div class="col-sm-10">
                                        <select class="form-select form-select-sm" data-bind="value: formulaDataFormat" required>
                                            <!-- ko ifnot: formulaOnlyHasDateFields -->
                                            <option>String</option>
                                            <option>Integer</option>
                                            <option>Decimal</option>
                                            <option>Currency</option>
                                            <!-- /ko -->
                                            <!-- ko if: formulaOnlyHasDateFields -->
                                            <option>Days</option>
                                            <option>Hours</option>
                                            <option>Minutes</option>
                                            <option>Seconds</option>
                                            <!-- /ko -->
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group row" data-bind="visible: formulaDataFormat() == 'Decimal' || formulaDataFormat() == 'Currency'">
                                    <label class="col-sm-2 control-label">Round to Decimal Places</label>
                                    <div class="col-sm-10">
                                        <input type="number" class="form-control" data-bind="value: formulaDecimalPlaces" placeholder="Choose Decimal places (leave blank to not use rounding)" title="Choose Decimal places (leave blank to not use rounding)" />
                                    </div>
                                </div>
                                  <div class="form-group row">
                                    <label class="col-sm-2 control-label">Field Builder Type</label>
                                    <div class="col-sm-10">
                                        <select class="form-select form-select-sm" data-bind="value: formulaType" required>
                                            <option value="build">Simple Calculation</option>
                                            <option value="sql">Advanced Expression</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-group row" data-bind="if: formulaType()=='build'">
                                    <label class="col-sm-2 control-label">Field Formula</label>
                                    <div class="col-sm-10">
                                        <div class="text-muted small" data-bind="visible: formulaFields().length == 0">Pick fields to build calculation</div>
                                        <div class="d-flex align-items-center flex-wrap" data-bind="foreach: formulaFields">
                                            <h3 class="me-3" data-bind="visible: setupFormula.isParenthesesStart" style="margin-top: 0;">(</h3>
                                            <div data-bind="if: !setupFormula.isParenthesesStart() && !setupFormula.isParenthesesEnd()" class="list-group me-3">
                                                <div class="list-group-item d-flex align-items-center formula-field-item" style="margin-left: 15px; padding: 5px 15px">
                                                    <span data-bind="text: fieldName, visible: !setupFormula.isConstantValue()"></span>
                                                    <div data-bind="if: setupFormula.isConstantValue" class="d-flex align-items-center">
                                                        <input data-bind="value: setupFormula.constantValue, visible: setupFormula.constantValue()!='|Today|'" class="form-control form-control-sm me-2" required />
                                                        <span data-bind="visible: setupFormula.constantValue() == '|Today|'"><b>Today</b></span>
                                                    </div>
                                                    <button class="btn btn-danger btn-sm ms-2" data-bind="click: $parent.removeField">
                                                        <i class="fa fa-trash"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            <h3 class="me-3" data-bind="visible: setupFormula.isParenthesesEnd" style="margin-top: 0;">)</h3>
                                            <div class="me-3" style="margin-left: 15px;" data-bind="visible: $parent.showFormulaOperation($index())">
                                                <select class="form-control form-control-sm" style="max-width: 50px;" data-bind="value: setupFormula.formulaOperation">
                                                    <!-- ko if: !$parent.formulaOnlyHasDateFields() || ($parent.formulaOnlyHasDateFields() && $parent.isConstantOperation($index())) -->
                                                    <option>+</option>
                                                    <!-- /ko -->
                                                    <option>-</option>
                                                    <!-- ko if: ['Integer','Money','Float','Double','Decimal','Currency'].indexOf($parent.formulaDataFormat()) != -1 -->
                                                    <option>*</option>
                                                    <option>/</option>
                                                    <!-- /ko -->
                                                </select>
                                            </div>
                                        </div>
                                        
                                    </div>
                                </div>

                                <div data-bind="with: customSqlField, visible: formulaType()=='sql'">
                                  <div class="row">
                                    <div class="col-md-12">

                                      <div class="mb-3">
                                        <label class="form-label">Select Data Operation:</label>
                                        <select class="form-select" data-bind="select2: {
                                                dropdownParent: $('#choose-data-card'),
		                                        placeholder: 'Select Function...',
		                                        data: availableFunctionsGrouped(),
		                                        templateResult: templateResult
	                                        }, value: selectedSqlFunction"></select>
                                      </div>

                                       <div class="mb-3" data-bind="hidden: isConditionalFunction() || selectedSqlFunction() == 'Other'">
                                        <label class="form-label">Select the Data Field to use:</label>
                                        <select class="form-select" 
                                             data-bind="select2: {
                                                dropdownParent: $('#choose-data-card'),
                                                placeholder: 'Select Field...',
                                                ajax: {
                                                    url: $parent.textQuery.searchFields.url,
                                                    dataType: 'json',
                                                    data: $parent.textQuery.searchFields.query,
                                                    processResults: $parent.textQuery.searchFields.processResults,
                                                    headers: $parent.textQuery.searchFields.headers
                                                },
                                                minimumInputLength: 2,
                                                allowClear: true
                                            }, select2Text: selectedField"></select>
                                      </div>

                                      <div class="mb-3" data-bind="if: requiresValue">
                                        <label for="inputValue" class="form-label">Provide the relevant value to use:</label>
                                        <input type="text" id="inputValue" class="form-control" data-bind="value: inputValue" required />
                                      </div>

                                      <div class="mb-3" data-bind="visible: selectedSqlFunction() == 'Other'">
                                        <label for="custom-sql" class="form-label">Custom SQL Expression:</label>
                                        <p class="text-muted">
                                              Build your custom SQL Expression below by selecting data fields, adding calculations or using SQL keywords as needed. For string values, remember to enclose them in single quotes ('')
                                        </p>
                                        <p id="custom-sql" class="hint-input" contenteditable="true" placeholder="Write your custom SQL"></p>
                                      </div>
                                      <div data-bind="visible: isConditionalFunction">
                                          <p class="text-muted">
                                              Build your conditional logic below by selecting data fields, adding calculations and defining conditions as needed, and provide corresponding results. For string values, remember to enclose them in single quotes ('')
                                          </p>
                                        <div class="input-group mb-3">
                                            <div class="flex-grow-1">
                                                <p class="hint-input" id="condition-field" contenteditable="true" placeholder="Field to compare" title="Field to compare"></p>
                                            </div>

                                            <div class="mx-2" style="width: 120px;">
                                                <select class="form-select form-select-sm" data-bind="options: availableOperators, value: selectedOperator"></select>
                                            </div>

                                            <div class="flex-grow-1">
                                                <p class="hint-input" id="condition-value" contenteditable="true" placeholder="Value to compare" title="Value to compare"></p>
                                            </div>

                                            <span class="input-group-text" style="max-height: 32px;">THEN</span>

                                            <div class="flex-grow-1">
                                                <p class="hint-input" id="condition-result" contenteditable="true" placeholder="Condition Result" title="Condition Result"></p>
                                            </div>
                                        </div>

                                        <button class="btn btn-outline-primary" data-bind="click: addCondition">Add Condition</button>
                                        <ul class="list-group mt-3" data-bind="foreach: conditions">
                                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                                <span data-bind="text: conditionDisplay"></span>
                                                <button class="btn btn-sm btn-danger" data-bind="click: $parent.removeCondition">Remove</button>
                                            </li>
                                        </ul>

                                        <div class="input-group mb-3" style="padding-top: 5px;">
                                            <span class="input-group-text" style="max-height: 32px;">ELSE</span>
                                            <div class="flex-grow-1">
                                                <p class="hint-input" id="condition-else" contenteditable="true" placeholder="Default Result" title="Default Result"></p>
                                            </div>
                                        </div>
                                      </div>
                                      
                                    </div>
                                  </div>
                                </div>

                                <div class="col-md-12">
                                    <hr />
                                    <a href="#" class="btn btn-primary btn-sm" title="Save Custom Formula Field" data-bind="click: saveFormulaField, visible: isFormulaField">Save</a>
                                    <a href="#" class="btn btn-sm" title="Custom Field using Formula" data-bind="click: cancelFormulaField, text: isFormulaField()? 'Cancel': 'Customize', css: {'btn-primary': !isFormulaField(), 'btn-danger': isFormulaField}"></a>
                                </div>
                            </div>
                         </div>
                        <div class="clearfix"></div>
                    </div>
                </div>
                <br />
                    <div class="card card-body">
                        <div>
                        <h5><span class="fa fa-table"></span>&nbsp;Selected data for the Report</h5>
                        <div>
                            <div data-bind="visible: ReportType()=='Bar'" class="card card-body" style="margin-bottom: 15px">
                                <div class="alert alert-info">
                                    <span class="fa fa-lightbulb-o fa-2x"></span>&nbsp;For Bar Graph, the first field below will show on the x-axis. All other fields will show on y-axis, but they must be numeric.
                                </div>
                                <div class="form-group row">
                                    <div class="checkbox col-6">
                                        <label>
                                            <input type="checkbox" data-bind="checked: barChartHorizontal" />
                                            Horizontal Bar Chart
                                        </label>
                                    </div>
                                    <div class="checkbox col-6">
                                        <label>
                                            <input type="checkbox" data-bind="checked: barChartStacked" />
                                            Stacked Bar Chart
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="alert alert-info" data-bind="visible: ReportType()=='Treemap'">
                                <span class="fa fa-lightbulb-o fa-2x"></span>&nbsp;For Treemap, the data must be in a hierarchical format with 2nd column having parent and third column having a numeric value. The data must have a single root node having null as its parent as well.
                            </div>
                            <div class="alert alert-info" data-bind="visible: ReportType()=='Line'">
                                <span class="fa fa-lightbulb-o fa-2x"></span>&nbsp;For Line Graph, the first field below will show on the x-axis and it needs to be numeric.
                            </div>
                            <div class="alert alert-info" data-bind="visible: ReportType()=='Pivot'">
                                <span class="fa fa-lightbulb-o fa-2x"></span>&nbsp;For Transpose, the first field below will be used to Pivot/Transpose the rows as columns, and it must be grouped.
                            </div>
                             <div class="alert alert-info" data-bind="visible: ReportType()=='Single'">
                                <span class="fa fa-lightbulb-o fa-2x"></span>&nbsp;Widget is a single value report that is ideal for placing on a Dashboard. All fields except one must be hidden for Widgets.
                            </div>
                            <div data-bind="visible: ReportType()=='Map'" class="card card-body" style="margin-bottom: 15px">
                                <div class="alert alert-info">
                                    <span class="fa fa-lightbulb-o fa-2x"></span>&nbsp;For Map Graph, the first field below has to be a Region, like a Country.
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-2 control-label">Map Display</label>
                                    <div class="col-sm-4">
                                        <select class="form-select form-control-sm" data-bind="options: $parent.mapRegions, value: mapRegion"></select>
                                    </div>
                                </div>
                            </div>
                            <ul class="list-group" data-bind="sortable: { data: SelectedFields, options: { handle: '.sortable', cursor: 'move', placeholder: 'drop-highlight' }, strategyMove: true }">
                                <li class="list-group-item">
                                    <div class="row">
                                        <div class="col-5">
                                            <span class="sortable pull-left" style="padding-right: 15px;" data-bind="ifnot: $parent.useStoredProc">
                                                <span class="fa fa-ellipsis-v" aria-hidden="true" title="Drag to reorder"></span>
                                            </span>
                                            <span class="fa fa-columns"></span>
                                            <span data-bind="text: selectedFieldName"></span>
                                            <span data-bind="text: isFormulaField() ? '(' + fieldFormat() + ')' : ''"></span>
                                            <span data-bind="visible: !$parent.isFieldValidForYAxis($index(), fieldType, selectedAggregate()) && $parent.ReportType() !='Treemap'">
                                                <span class="badge bg-danger" data-bind="visible: !groupInGraph()">Will not show in <span data-bind="text: $parent.ReportType"></span>Chart</span>
                                            </span>
                                        </div>
                                        <div class="col-7">
                                            <div class="pull-right" style="margin-top: -5px;" data-bind="if: $parent.AggregateReport() && !$parent.useStoredProc()">
                                                <select class="form-select form-control-sm" data-bind="options: $parent.canDrilldown() && $index()>0 ? fieldAggregateWithDrilldown : fieldAggregate, value: selectedAggregate"></select>
                                            </div>

                                            <div class="pull-right" style="padding-right: 10px;" data-bind="ifnot: $parent.useStoredProc">
                                                <span class="fa fa-trash-o" title="Cannot Delete Required Filter" data-bind="visible: forceFilterForTable"></span>
                                                <span class="fa fa-trash" style="cursor: pointer;" aria-hidden="true" title="Delete this Field" data-bind="click: $parent.RemoveField, hidden: forceFilterForTable"></span>
                                            </div>
                                            <!--<div class="pull-right" style="padding-right: 10px;" data-bind="ifnot: $parent.useStoredProc">
                                                <span class="button-box no-padding" tabindex="0" data-bind="click: function(){ filterOnFly(!filterOnFly()); }, css: {active: filterOnFly()==true}">
                                                    <span class="fa fa-filter" aria-hidden="true" title="Filter by this field on the Report"></span>
                                                </span>
                                            </div>-->
                                            <div class="pull-right" style="padding-right: 10px;" data-bind="visible: $parent.ReportType()!='Pivot'">
                                                <span class="button-box no-padding" tabindex="0" data-bind="click: toggleDisable, css: {active: disabled()==true}">
                                                    <span class="fa fa-close" aria-hidden="true" title="Do not include in Report"></span>
                                                </span>
                                            </div>
                                            <div class="pull-right" style="padding-right: 10px;" data-bind="visible: $parent.ReportType()!='Pivot' && $parent.ReportType()!='List' && !$parent.useStoredProc()">
                                                <span class="button-box no-padding" tabindex="0" data-bind="click: function(){ hideInDetail(!hideInDetail()); }, css: {active: hideInDetail()==true}">
                                                    <span class="fa fa-eye-slash" aria-hidden="true" title="Hide in Details"></span>
                                                </span>
                                            </div>
                                            <div class="pull-right" style="padding-right: 10px;" data-bind="visible: $parent.isFieldValidForYAxis($index(), fieldType, selectedAggregate())  && $parent.isChart() && $index()>0">
                                                <span class="button-box no-padding" tabindex="0" data-bind="click: function(){ groupInGraph(!groupInGraph()); }, css: {active: groupInGraph()==false}">
                                                    <span class="fa fa-line-chart" aria-hidden="true" title="Include in series"></span>
                                                </span>
                                            </div>
                                            <div class="pull-right" style="padding-right: 10px;" data-bind="visible: $parent.IncludeSubTotal()  &&  (['Int', 'Double', 'Money', 'Decimal', 'Currency'].indexOf(fieldType) >= 0 || ['Int', 'Double', 'Money', 'Decimal', 'Currency'].indexOf(fieldFormat()) >= 0)">
                                                <span class="button-box no-padding" tabindex="0" data-bind="click: function(){ dontSubTotal(!dontSubTotal()); }, css: {active: dontSubTotal()==true}">
                                                    <span class="fa fa-plus-circle" aria-hidden="true" title="Don't add to Total row"></span>
                                                </span>
                                            </div>
                                            <div class="pull-right" style="padding-right: 10px;" data-bind="visible: $parent.ReportType()!='Pivot'">
                                                <span class="button-box no-padding" tabindex="0" data-bind="click: setupLinkField, css: {active: linkField()==true}">
                                                    <span class="fa fa-link" aria-hidden="true" title="Link to another Report or Url"></span>
                                                </span>
                                            </div>
                                            <div class="pull-right" style="padding-right: 10px;">
                                                <span class="button-box no-padding" tabindex="0" data-bind="click: setupFieldOptions">
                                                    <span class="fa fa-gear" aria-hidden="true" title="More Options"></span>
                                                </span>
                                            </div>
                                            <div class="pull-right" style="padding-right: 10px;" data-bind="if: isFormulaField">
                                                <span class="button-box no-padding" tabindex="0" data-bind="click: editFormulaField">
                                                    <span class="fa fa-pencil" aria-hidden="true" title="Edit Formula Field"></span>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                    </div>
                    <br />
                <div class="card card-body">
                    <h5><span class="fa fa-filter"></span>&nbsp;Choose Filters</h5>

                    <div class="row" style="padding: 10px 10px; overflow-x: auto;">
                        <div data-bind="if: useStoredProc" class="col-md-12">
                            <div data-bind="template: {name: 'filter-parameters'}"></div>
                        </div>
                        <div data-bind="ifnot: useStoredProc" class="col-md-12">
                            <div data-bind="template: {name: 'filter-group'}"></div>
                        </div>

                        <div class="checkbox col-12">
                            <label>
                                <input type="checkbox" data-bind="checked: EditFiltersOnReport" />
                                Allow setting up and saving filters on Report
                            </label>
                        </div>
                        <br />
                    </div>
                </div>

                <br />
                <div data-bind="hidden: useStoredProc" class="card card-body">
                    <h5><span class="fa fa-sort"></span>&nbsp;Choose Sorting</h5>
                    <div data-bind="ifnot: useStoredProc">
                        <div class="form-group row">
                            <label class="col-sm-2 control-label">Sort By</label>
                            <div class="col-sm-6">
                                <select class="form-select" data-bind="options: FilteredFields, optionsText: 'selectedFieldName', optionsValue: 'fieldId', value: SortByField, optionsCaption: 'Select field to sort...', allowClear: true"></select>
                            </div>
                            <div class="col-sm-2">
                                <button class="btn btn-sm btn-secondary" data-bind="text: !SortDesc() ? '▲ Ascending' : 'Descending ▼', click: function() { SortDesc(!SortDesc()); return false; }"></button>
                            </div>
                            <div class="col-sm-2">
                                <button class="btn btn-sm btn-secondary" data-bind="click: addSortField">Add Sort</button>
                            </div>
                        </div>
                        <div data-bind="foreach: SortFields">
                            <div class="form-group row">
                                <label class="col-sm-2 control-label">&nbsp;&nbsp;Then Sort By</label>
                                <div class="col-sm-4">
                                    <select class="form-select" required data-bind="options: $parent.FilteredFields, optionsText: 'selectedFieldName', optionsValue: 'fieldId', value: sortByFieldId"></select>
                                </div>
                                <div class="col-sm-2">
                                    <button class="btn btn-sm btn-secondary" data-bind="click: remove">Remove Sort</button>
                                </div>
                                <div class="col-sm-2">
                                    <button class="btn btn-sm btn-secondary" data-bind="text: !sortDesc() ? '▲ Ascending' : 'Descending ▼', click: function() { sortDesc(!sortDesc()); return false; }"></button>
                                </div>
                                <div class="col-sm-2">
                                    <button class="btn btn-sm btn-secondary" data-bind="click: $parent.addSortField">Add Sort</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <br />
                <div data-bind="visible: SaveReport" class="card card-body">
                    <h5><span class="fa fa-hourglass"></span>&nbsp;Choose Schedule</h5>

                    <div style="padding: 10px 10px" data-bind="if: SaveReport">
                        <div data-bind="template: {name: 'report-schedule'}"></div>
                    </div>
                </div>
                <br />
                <div data-bind="ifnot: useStoredProc" class="card card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h5><span class="fa fa-gear"></span>&nbsp;Optional Settings</h5>
                            <div class="checkbox" data-bind="visible: ReportType()!='Pivot'">
                                <label>
                                    <input type="checkbox" data-bind="checked: IncludeSubTotal" />
                                    Include Total Row
                                </label>
                            </div>
                            <div class="checkbox" data-bind="hidden: AggregateReport">
                                <label>
                                    <input type="checkbox" data-bind="checked: ShowUniqueRecords" />
                                    Show only Unique Records
                                </label>
                            </div>
                            <div class="checkbox" data-bind="visible: ReportType()!='List'">
                                <label>
                                    <input type="checkbox" data-bind="checked: ShowExpandOption" />
                                    Don't Show Expand Option
                                </label>
                            </div>
                            <div class="checkbox">
                                <label>
                                    <input type="checkbox" data-bind="checked: DontExecuteOnRun" />
                                    Wait to Select Filters before Running Report
                                </label>
                            </div>
                            <div class="form-group row">
                                <div class="checkbox col-md-5">
                                    <label>
                                        <input type="checkbox" data-bind="checked: maxRecords" />
                                        Max Records
                                    </label>
                                </div>
                                <div class="col-md-5" data-bind="if: maxRecords">
                                    <input type="number" style="width: 150px;" class="form-control" required placeholder="Only top n..." data-bind="value: OnlyTop, visible: maxRecords">
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="checkbox col-md-5">
                                   <label>
                                        <input type="checkbox" data-bind="checked: changePageSize" />
                                        Change Page Size
                                    </label>
                                </div>
                                <div class="col-md-5" data-bind="visible: changePageSize">
                                    <select style="width: 150px;" class="form-select" data-bind="options: [10,30,50,100,150,200,500,1000], value: DefaultPageSize"></select>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <b><span class="fa fa-paint-brush"></span>&nbsp;Pick Report Format</b>
                            <div>
                                <!-- ko foreach: tableStyles -->
                                <div class="dropdown-option" data-bind="title: $data.name, click: $parent.selectStyle, css: {'dropdown-option-selected': $parent.selectedStyle() == $data.colorscheme}">
                                    <div class="mini-table-preview" data-bind="foreach: new Array(5)">
                                        <div class="mini-table-row" data-bind="foreach: new Array(5)">
                                            <div class="mini-table-cell" data-bind="style: { backgroundColor: $parentContext.$index() === 0 ? $parents[1].headerBg : ($parentContext.$index() % 2 === 0 ? $parents[1].altRowBg : $parents[1].rowBg), color: $parents[1].textColor }"></div>

                                        </div>
                                    </div>
                                </div>
                                <!-- /ko -->
                            </div>
                            <div class="checkbox">
                                <label>
                                    <input type="checkbox" data-bind="checked: noHeaderRow" />
                                    No Header Row
                                </label>
                            </div>
                            <div class="checkbox">
                                <label>
                                    <input type="checkbox" data-bind="checked: noDashboardBorders" />
                                    Borderless on Dashboard
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <br />
                <div data-bind="visible: adminMode" class="card card-body">
                    <div data-bind="template: {name: 'manage-access-template'}"></div>
                </div>

                </div>
            </div>
        </div>
        <div class="modal-footer">
            <a href="#" class="btn btn-danger" data-bind="click: cancelCreateReport">Cancel editing Report</a>
            <button class="btn btn-primary" type="button" data-bind="visible: SaveReport() && CanSaveReports(), click: SaveWithoutRun" style="padding-right: 10px;">Save Report</button>
            <button class="btn btn-primary" type="button" data-bind="text: SaveReport() && CanSaveReports()? 'Save & Run Report': 'Run Report', click: RunReport">Run Report</button>
        </div>

        </div>
    </div>
</script>

<div class="modal" id="drilldownModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" data-bind="with: ChartDrillDownData">
            <div class="modal-header">
                <h4 class="modal-title">Drilldown Data</h4>
                <button type="button" class="btn-close pull-right" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <!-- ko if: DrillDownData -->
            <div class="modal-body">
                <div style="overflow-x: auto; max-height: 500px; overflow-y: auto;">
                <table class="table table-striped table-hover table-condensed" data-bind="with: DrillDownData, attr: {class: 'table table-striped table-hover table-condensed ' + $parent.selectedStyle()}">
                    <thead style="position: sticky; top: -1px; z-index: 2;">
                        <tr class="no-highlight">
                            <!-- ko foreach: Columns -->
                            <th data-bind="attr: { id: fieldId }, css: {'right-align': IsNumeric}, style: {'width': fieldWidth, 'background-color': headerBackColor }, hidden: outerGroup" style="border-right: 1px solid;">
                                <span data-bind="text: fieldLabel2() ? fieldLabel2() : (fieldLabel() ? fieldLabel() : fieldName), style: {'color': headerFontColor, 'font-weight': headerFontBold() ? 'bold' : 'normal'}"></span>
                            </th>
                            <!-- /ko -->
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="display: none;" data-bind="visible: Rows && Rows.length < 1">
                            <td class="text-info" data-bind="attr:{colspan: Columns.length}">
                                No records found
                            </td>
                        </tr>
                        <!-- ko foreach: Rows  -->
                        <tr>
                            <!-- ko foreach: Items -->
                            <td data-bind="hidden: outerGroup, style: {'background-color': backColor, 'color': fontColor, 'font-weight': fontBold() ? 'bold' : 'normal' }">
                                <div data-bind="style: {'width': fieldWidth }">
                                    <!-- ko if: LinkTo-->
                                    <a data-bind="attr: {href: LinkTo}" target="_blank"><span data-bind="html: formattedVal"></span></a>
                                    <!-- /ko-->
                                    <!-- ko ifnot: LinkTo-->
                                    <span data-bind="html: formattedVal"></span>
                                    <!-- /ko-->
                                </div>
                            </td>
                            <!-- /ko-->
                        </tr>
                        <!-- /ko -->
                    </tbody>
                </table>
                </div>
            </div>
            <div class="modal-footer">
                <div class="col-xs-12 col-centered" data-bind="with: pager">
                    <div class="form-inline small text-muted">
                        <div class="pull-left total-records" data-bind="visible: pages()">
                            <span data-bind="text: 'Total Records: ' + totalRecords()"></span>
                        </div>
                        <div class="pull-left">
                            <button class="btn btn-xs" title="Download Excel" data-bind="click: $parent.exportExcel"><span class="fa fa-file-excel-o"></span></button>
                        </div>
                        <div class="form-group pull-right" data-bind="visible: pages()">
                            <div data-bind="template: 'pager-template', data: $data"></div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /ko -->
        </div>
    </div>
</div>

<div class="modal" id="noaccountModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                <h4 class="modal-title">Account not Setup</h4>
            </div>
            <div class="modal-body">
                <p class="alert alert-danger">dotnet Report Account Configuration missing!</p>
                <p>You do not have the neccessary initial configuration completed to use dotnet Report.</p>
                <p>Please view the <a href="https://dotnetreport.com/blogs/getting-started-with-dotnet-report/" target="_blank">Getting Started Guide</a> to correctly configure dotnet Report.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
